define(["jquery","block_ases/Modernizr-v282","block_ases/bootstrap","block_ases/datatables","block_ases/sweetalert","block_ases/select2"],function(a,b,c,d,e,f){return{init:function(){function b(b,c){a("#periodos").change(function(){if("sistemas"!=namerol){var e=a("#periodos").val(),f=v;a.ajax({type:"POST",data:{id_persona:f,id_semestre:e,instance:b,otro:!0,type:"consulta_sistemas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){""==b?(a("#reemplazarToogle").html("<label> No se encontraron registros </label>"),d(c)):a("#reemplazarToogle").html(b),a(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").slideDown("slow"),d(c)},dataType:"text",cache:"false",error:function(a){alert("error al consultar seguimientos de personas")}})}})}function c(b){a("#personas").val("").change(),a("#personas").select2({placeholder:"Seleccionar persona",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),a("#periodos").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),m(b,namerol),a("#consultar_persona").on("click",function(){var c=a("#personas").children(":selected").attr("value"),d=a("#periodos").children(":selected").attr("value");void 0==c?swal({title:"Debe escoger una persona para realizar la consulta",html:!0,type:"warning",confirmButtonColor:"#d51b23"}):(a(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").show(),a(".se-pre-con").show(),a("#reemplazarToogle").hide(),a.ajax({type:"POST",data:{id_persona:c,id_semestre:d,instance:b,type:"consulta_sistemas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){""==b?a("#reemplazarToogle").html("<label> No se encontraron registros </label>"):(a("#reemplazarToogle").html(b),a("input[name=practicante]").prop("disabled",!0),a("input[name=profesional]").prop("disabled",!0)),a(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").slideDown("slow")},dataType:"text",cache:"false",error:function(a){alert("error al consultar seguimientos de personas")},complete:function(){a(".se-pre-con").hide(),a("#reemplazarToogle").fadeIn()}}))})}function d(b){var c=a("#periodos option:selected").text(),d=0,f="";if("monitor_ps"==b.namerol){var g=e(b);f='<div class="row"><div class="col-sm-12"><h2>Información monitor - PERIODO :'+c+' </h2><div class="panel panel-default"> <div class="panel-body"><h4 class="panel-title"><span class="pull-left"> Revisados  :<label for="revisado_monitor_'+d+'">'+g[0]+'</label><b></b> - NO Revisados :<label for="norevisado_monitor_'+d+'">'+g[1]+'</label><b></b> - Total  :<label for="total_monitor_'+d+'">'+g[2]+"</label> <b></b> </span></h4></div></div></div></div>",a("#conteo_principal").empty(),a("#conteo_principal").html(f)}else if("practicante_ps"==b.namerol){var h=e(b);f='<div class="row"><div class="col-sm-12"><h2>Información practicante - PERIODO :'+c+' </h2><div class="panel panel-default"> <div class="panel-body"><h4 class="panel-title"><span class="pull-left"> Revisados  :'+h[0]+" <b></b> - NO Revisados :"+h[1]+" <b></b> - Total  :"+h[2]+" <b></b> </span></h4></div></div></div></div>",a("#conteo_principal").empty(),a("#conteo_principal").html(f)}else if("profesional_ps"==b.namerol){var i=e(b);f='<div class="row"><div class="col-sm-12"><h2>Información profesional - PERIODO :'+c+' </h2><div class="panel panel-default"> <div class="panel-body"><h4 class="panel-title"><span class="pull-left"> Revisados  :'+i[0]+" <b></b> - NO Revisados :"+i[1]+" <b></b> - Total  :"+i[2]+" <b></b> </span></h4></div></div></div></div>",a("#conteo_principal").empty(),a("#conteo_principal").html(f)}else"sistemas"==b.namerol}function e(b,c){void 0===c&&(c="ninguno");var d=[],f=0,g=0,h=0,i=0;if("monitor_ps"==b.namerol){var j=0,k=0;"ninguno"==c?(j=a(".panel-heading.pares").children().length,k=a(".panel-heading.grupal").children().length):(j=a("#collapse"+b.id+" .panel-heading.pares").children().length,k=a("#collapse"+b.id+" .panel-heading.grupal").children().length),a("label[for='norevisado_grupal_"+b.id+"']").html(k),a("label[for='total_grupal_"+b.id+"']").html(k);for(var l=0;l<j;l++)h+=Number(a("label[for='revisado_pares_"+b.id+"_"+l+"']").text()),i+=Number(a("label[for='norevisado_pares_"+b.id+"_"+l+"']").text());for(var l=0;l<k;l++)f+=0,g=k;return total=h+f+(i+g),new Array(h+f,i+g,total)}if("practicante_ps"==b.namerol){var m=0;d=[0,0,0];var n=[];if("ninguno"==c){m=a(".panel-heading.practicante").children().length;for(var o=0;o<m;o++){var p=a(".panel-heading.practicante:eq("+o+")").find("a").attr("href"),q=p.split("#collapse")[1],r=[];r.id=q,r.namerol="monitor_ps",n=e(r,"practicante"),a("label[for='revisado_monitor_"+q+"']").html(n[0]),a("label[for='norevisado_monitor_"+q+"']").html(n[1]),a("label[for='total_monitor_"+q+"']").html(n[2]),d[0]+=n[0],d[1]+=n[1],d[2]+=n[2]}}else{m=a("#collapse"+b.id+" .panel-heading.practicante").children().length;for(var o=0;o<m;o++){var p=a("#collapse"+b.id+" .panel-heading.practicante:eq("+o+")").find("a").attr("href"),q=p.split("#collapse")[1],r=[];r.id=q,r.namerol="monitor_ps",n=e(r,"practicante"),a("label[for='revisado_monitor_"+q+"']").html(n[0]),a("label[for='norevisado_monitor_"+q+"']").html(n[1]),a("label[for='total_monitor_"+q+"']").html(n[2]),d[0]+=n[0],d[1]+=n[1],d[2]+=n[2]}}return d}if("profesional_ps"==b.namerol){d=[0,0,0];for(var s=a(".panel-heading.profesional").children().length,t=[],u=0;u<s;u++){var p=a(".panel-heading.profesional:eq("+u+")").find("a").attr("href"),v=p.split("#collapse")[1],w=[];w.id=v,w.namerol="practicante_ps",t=e(w,"practicante"),a("label[for='revisado_practicante_"+v+"']").html(t[0]),a("label[for='norevisado_practicante_"+v+"']").html(t[1]),a("label[for='total_practicante_"+v+"']").html(t[2]),d[0]+=t[0],d[1]+=t[1],d[2]+=t[2]}return d}}function f(b){a("body").on("click",".btn.btn-info.btn-lg.botonCorreo",function(){var b=a(this).attr("value"),c=a("#textarea_"+b);if(""==c.val())swal({title:"Para enviar una observación debe llenar el campo correspondiente",html:!0,type:"error",confirmButtonColor:"#d51b23"});else{var d=c.attr("name").split("_"),e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],j=c.val();a.ajax({type:"POST",data:{type:"send_email_to_user",tipoSeg:e,codigoEnviarN1:f,codigoEnviarN2:g,fecha:h,nombre:i,message:j},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(a){"Error"!=a?(swal({title:"Correo enviado",html:!0,type:"success",confirmButtonColor:"#d51b23"}),c.val("")):swal({title:"error al enviar el correo al monitor",html:!0,type:"error",confirmButtonColor:"#d51b23"})},dataType:"text",cache:"false",error:function(a){swal({title:"error al enviar el correo",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}})}function g(b){a("body").on("click","span.btn.btn-info.btn-lg.botonModificarSeguimiento",function(){var c=a(this).attr("value"),d="",e="",f=document.getElementById("h_ini_"+c),g=document.getElementById("h_fin_"+c),h=document.getElementById("m_ini_"+c),i=document.getElementById("m_fin_"+c),j=f.options[f.selectedIndex].text,k=g.options[g.selectedIndex].text,m=h.options[h.selectedIndex].text,o=i.options[i.selectedIndex].text,p=n(j,k,m,o);if(l(c,b),""==p){d=a("#profesional_"+c).is(":checked")?1:0,e=a("#practicante_"+c).is(":checked")?1:0;var q=a(this).parent().parent().parent(),r=a(this).attr("value"),s=q.find("#lugar_"+r).val(),t=q.find("#tema_"+c).val(),u=q.find("#objetivos_"+c).val(),v=q.find("#fecha_"+c).val(),w=j+":"+m,x=k+":"+o,y=q.find("#obindividual_"+c).val(),z=a("input[name='riesgo_individual_"+c+"']:checked").val();void 0==z&&(z="0");var A=q.find("#obfamiliar_"+c).val(),B=a("input[name='riesgo_familiar_"+c+"']:checked").val();void 0==B&&(B="0");var C=q.find("#obacademico_"+c).val(),D=a("input[name='riesgo_academico_"+c+"']:checked").val();void 0==D&&(D="0");var E=q.find("#obeconomico_"+c).val(),F=a("input[name='riesgo_economico_"+c+"']:checked").val();void 0==F&&(F="0");var G=q.find("#obuniversitario_"+c).val(),H=a("input[name='riesgo_universitario_"+c+"']:checked").val();void 0==H&&(H="0");var I=q.find("#observacionesGeneral_"+c).val();if(""==s||""==t||""==u)swal({title:"Debe ingresar los datos completamente",html:!0,type:"warning",confirmButtonColor:"#d51b23"});else if(""!=y&&0==z||""!=A&&0==B||""!=C&&0==D||""!=E&&0==F||""!=G&&0==H||""==y&&z>0||""==A&&B>0||""==C&&D>0||""==E&&F>0||""==G&&H>0)swal({title:"Debe ingresar correctamente los riesgos",html:!0,type:"warning",confirmButtonColor:"#d51b23"});else{var J=new Object;J.id=r,J.lugar=s,J.tema=t,J.objetivos=u,J.individual=y,J.individual_riesgo=z,J.familiar_desc=A,J.familiar_riesgo=B,J.academico=C,J.academico_riesgo=D,J.economico=E,J.economico_riesgo=F,J.vida_uni=G,J.vida_uni_riesgo=H,J.observaciones=I,J.revisado_practicante=e,J.revisado_profesional=d,J.fecha=v,J.hora_ini=w,J.hora_fin=x,a.ajax({type:"POST",data:{seguimiento:J,type:"actualizar_registro"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(a){"0"==a?swal({title:"error al actualizar registro",html:!0,type:"error",confirmButtonColor:"#d51b23"}):"1"==a?swal("¡Hecho!","El registro ha sido actualizado","success"):swal({title:"Debe ingresar correctamente los riesgos",html:!0,type:"warning",confirmButtonColor:"#d51b23"})},error:function(a){}})}}else swal({title:p,html:!0,type:"warning",confirmButtonColor:"#d51b23"})})}function h(b){a("body").on("click","span.btn-info.btn-lg.botonesSeguimiento.botonEditarSeguimiento",function(){var c=a(this).attr("value"),d=a(this).parent().parent().parent(),e=!1;"monitor_ps"==b?e=a("#profesional_"+c).is(":checked"):"practicante_ps"==b?a("input[name=practicante]").prop("disabled",!1):"profesional_ps"==b?a("input[name=profesional]").prop("disabled",!1):"sistemas"==b&&(a("input[name=profesional]").prop("disabled",!1),a("input[name=practicante]").prop("disabled",!1)),0==e?(d.find(".editable").removeAttr("readonly"),d.find(".botonesSeguimiento").toggleClass("ocultar"),d.find(".quitar-ocultar").toggleClass("ocultar"),d.find(".radio-ocultar").toggleClass("ocultar"),r(c),t(c)):swal("¡Advertencia!","No es posible editar el seguimiento, debido a que ya ha sido revisado por un profesional","warning")})}function i(b){a("body").on("click","span.btn.btn-info.btn-lg.botonBorrar",function(){var c=a(this).attr("value"),d=!1;"monitor_ps"==b&&(d=a("#profesional_"+v).is(":checked")),0==d&&swal({title:"¿Seguro que desea eliminar el registro?",text:"No podrás deshacer este paso",type:"warning",showCancelButton:!0,cancelButtonText:"No",confirmButtonColor:"#d51b23",confirmButtonText:"Si",closeOnConfirm:!1},function(){a.ajax({type:"POST",data:{id:c,type:"eliminar_registro"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(a){swal({title:a.title,html:!0,text:a.msg,type:a.type,confirmButtonColor:"#d51b23"}),setTimeout("document.location.reload()",500)},dataType:"json",cache:"false",error:function(a){}})})})}function j(b){a("body").on("click","span.btn.btn-info.btn-lg.botonesSeguimiento.botonCancelarSeguimiento",function(){var c=a(this).attr("value");"monitor_ps"==b||("practicante_ps"==b?a("input[name=practicante]").prop("disabled",!0):"profesional_ps"==b?a("input[name=profesional]").prop("disabled",!0):"sistemas"==b&&(a("input[name=profesional]").prop("disabled",!0),a("input[name=practicante]").prop("disabled",!0)));var d=a(this).parent().parent().parent();d.find(".editable").attr("readonly",!0),d.find(".botonesSeguimiento").toggleClass("ocultar"),d.find(".quitar-ocultar").toggleClass("ocultar"),d.find(".radio-ocultar").toggleClass("ocultar"),q(c)})}function k(){a("body").on("click",".limpiar",function(){var b=a(this).closest("div").attr("id").split("_"),c=b[2].split("div").pop();switch(b[1]){case"individual":a("#obindividual_"+c).val(""),s("riesgo_individual_",c);break;case"familiar":a("#obfamiliar_"+c).val(""),s("riesgo_familiar_",c);break;case"academico":a("#obacademico_"+c).val(""),s("riesgo_academico_",c);break;case"economico":a("#obeconomico_"+c).val(""),s("riesgo_economico_",c);break;case"universitario":a("#obuniversitario_"+c).val(""),s("riesgo_universitario_",c);break;default:alert("Dato invalido")}})}function l(b,c){var d=new Array,e=new Array,f=a("input:radio[name=riesgo_individual_"+b+"]:checked").val(),g=a("input:radio[name=riesgo_familiar_"+b+"]:checked").val(),h=a("input:radio[name=riesgo_academico_"+b+"]:checked").val(),i=a("input:radio[name=riesgo_economico_"+b+"]:checked").val(),j=a("input:radio[name=riesgo_universitario_"+b+"]:checked").val();"3"==f&&(d.push("Individual"),e.push(a("#obindividual_"+b).val())),"3"==g&&(d.push("Familiar"),e.push(a("#obfamiliar_"+b).val())),"3"==h&&(d.push("Académico"),e.push(a("#obacademico_"+b).val())),"3"==i&&(d.push("Económico"),e.push(a("#obeconomico_"+b).val())),"3"==j&&(d.push("Vida universitaria"),e.push(a("#obuniversitario_"+b).val()));var k=new Array;k.push({name:"function",value:"send_email"}),k.push({name:"id_student_moodle",value:c}),k.push({name:"id_student_pilos",value:b}),k.push({name:"risk_array",value:d}),k.push({name:"observations_array",value:e}),k.push({name:"date",value:a("#fecha_"+b).val()}),k.push({name:"url",value:window.location}),0!=d.length&&a.ajax({type:"POST",data:k,url:"../managers/user_management/seguimiento.php",success:function(a){console.log(a)},dataType:"text",cache:"false",error:function(a){console.log(a)}})}function m(b,c){a("#periodos").change(function(){var d=a("#periodos").val();a.ajax({type:"POST",data:{id:d,instance:b,type:"actualizar_personas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){if(a("#personas").empty(),a("#personas").select2({placeholder:"Seleccionar persona",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),"sistemas"==c){var d='<option value="">Seleccionar persona</option>';a("#personas").attr("selectedIndex","-1").find("option:selected").removeAttr("selected"),a("#personas").append(d+b)}},dataType:"text",cache:"false",error:function(a){alert("error al cargar personas")}})})}function n(a,b,c,d){var e="";return a>b?e+="* La hora final debe ser mayor a la inicial<br>":a==b&&(c>d?(isvalid=!1,e+="* La hora final debe ser mayor a la inicial<br>"):c==d&&(e+="* Las horas seleccionadas deben ser diferentes<br>")),e}function o(b){for(var c=new Date,d=c.getMinutes(),e=c.getHours(),f="",g=0;g<24;g++)g==e?(e<10&&(e="0"+e),f+='<option value="'+e+'" selected>'+e+"</option>"):f+=g<10?'<option value="0'+g+'">0'+g+"</option>":'<option value="'+g+'">'+g+"</option>";for(var h="",g=0;g<60;g++)g==d?(d<10&&(d="0"+d),h+='<option value="'+d+'" selected>'+d+"</option>"):h+=g<10?'<option value="0'+g+'">0'+g+"</option>":'<option value="'+g+'">'+g+"</option>";a("#h_ini_"+b).append(f),a("#m_ini_"+b).append(h),a("#h_fin_"+b).append(f),a("#m_fin_"+b).append(h),a("#seguimiento #m_fin").append(h)}function p(){a(document).ready(function(){a("input:radio").change(function(){var b=a(this).parent().parent().parent().attr("id"),c=a(this).attr("value");1==c?(a("#"+b).removeClass(),a("#"+b).addClass("table-info-pilos col-sm-12 riesgo_bajo")):2==c?(a("#"+b).removeClass(),a("#"+b).addClass("table-info-pilos col-sm-12 riesgo_medio")):3==c&&(a("#"+b).removeClass(),a("#"+b).addClass("table-info-pilos col-sm-12 riesgo_alto"))})})}function q(b){a("#titulo_fecha_"+b).hide(),a("#borrar_"+b).show(),a("#editar_"+b).show(),a("#enviar_"+b).show(),a("#hora_final_"+b).show(),a("#mod_hora_final_"+b).hide(),a("#hora_inicial_"+b).show(),a("#mod_hora_ini_"+b).hide()}function r(b){a("#borrar_"+b).hide(),a("#editar_"+b).hide(),a("#enviar_"+b).hide(),a("#hora_final_"+b).hide(),a("#hora_inicial_"+b).hide(),a("#titulo_fecha_"+b).show(),a("#mod_hora_final_"+b).show(),a("#mod_hora_ini_"+b).show();var c=a("#h_inicial_texto_"+b).val(),d=a("#h_final_texto_"+b).val(),e=c.split(":"),f=d.split(":");o(b),a("#h_ini_"+b+" option[value="+e[0]+"]").prop("selected",!0),a("#m_ini_"+b+" option[value="+e[1]+"]").prop("selected",!0),a("#h_fin_"+b+" option[value="+f[0]+"]").prop("selected",!0),a("#m_fin_"+b+" option[value="+f[1]+"]").prop("selected",!0)}function s(b,c){a("input:radio[name="+b+c+"]").parent().parent().parent().removeClass("riesgo_bajo"),a("input:radio[name="+b+c+"]").parent().parent().parent().removeClass("riesgo_medio"),a("input:radio[name="+b+c+"]").parent().parent().parent().removeClass("riesgo_alto");var d='"'+b.replace("#","")+c+'"';a("input:radio[name="+d+"]").each(function(a){this.checked=!1})}function t(b){a("#riesgo_individual_"+b).is(".riesgo_bajo")?a("input[name=riesgo_individual_"+b+"][value=1]").prop("checked","checked"):a("#riesgo_individual_"+b).is(".riesgo_medio")?a("input[name=riesgo_individual_"+b+"][value=2]").prop("checked","checked"):a("#riesgo_individual_"+b).is(".riesgo_alto")?a("input[name=riesgo_individual_"+b+"][value=3]").prop("checked","checked"):a("input[name=riesgo_individual_"+b+"][value=0]").prop("checked","checked"),a("#riesgo_familiar_"+b).is(".riesgo_bajo")?a("input[name=riesgo_familiar_"+b+"][value=1]").prop("checked","checked"):a("#riesgo_familiar_"+b).is(".riesgo_medio")?a("input[name=riesgo_familiar_"+b+"][value=2]").prop("checked","checked"):a("#riesgo_familiar_"+b).is(".riesgo_alto")?a("input[name=riesgo_familiar_"+b+"][value=3]").prop("checked","checked"):a("input[name=riesgo_familiar_"+b+"][value=0]").prop("checked","checked"),a("#riesgo_academico_"+b).is(".riesgo_bajo")?a("input[name=riesgo_academico_"+b+"][value=1]").prop("checked","checked"):a("#riesgo_academico_"+b).is(".riesgo_medio")?a("input[name=riesgo_academico_"+b+"][value=2]").prop("checked","checked"):a("#riesgo_academico_"+b).is(".riesgo_alto")?a("input[name=riesgo_academico_"+b+"][value=3]").prop("checked","checked"):a("input[name=riesgo_academico_"+b+"][value=0]").prop("checked","checked"),a("#riesgo_economico_"+b).is(".riesgo_bajo")?a("input[name=riesgo_economico_"+b+"][value=1]").prop("checked","checked"):a("#riesgo_economico_"+b).is(".riesgo_medio")?a("input[name=riesgo_economico_"+b+"][value=2]").prop("checked","checked"):a("#riesgo_economico_"+b).is(".riesgo_alto")?a("input[name=riesgo_economico_"+b+"][value=3]").prop("checked","checked"):a("input[name=riesgo_economico_"+b+"][value=0]").prop("checked","checked"),a("#riesgo_universitario_"+b).is(".riesgo_bajo")?a("input[name=riesgo_universitario_"+b+"][value=1]").prop("checked","checked"):a("#riesgo_universitario_"+b).is(".riesgo_medio")?a("input[name=riesgo_universitario_"+b+"][value=2]").prop("checked","checked"):a("#riesgo_universitario_"+b).is(".riesgo_alto")?a("input[name=riesgo_universitario_"+b+"][value=3]").prop("checked","checked"):a("input[name=riesgo_universitario_"+b+"][value=0]").prop("checked","checked")}var u=0,v=0,w="",x="";a(document).ready(function(){a(".se-pre-con").fadeOut("slow"),a("#reemplazarToogle").fadeIn("slow");for(var e="",l=window.location.search.split("&"),m=0;m<l.length;m++){var n=l[m].split("=");if("?instanceid"==n[0]||"instanceid"==n[0])var o=n[1]}a.ajax({type:"POST",data:{type:"getInfo",instance:o},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){$data=a.parseJSON(b),w=$data.username,v=$data.id,x=$data.email,u=$data.rol,namerol=$data.name_rol},dataType:"text",cache:"false",error:function(a){swal({title:"error al obtener información del usuario, getInfo.",html:!0,type:"error",confirmButtonColor:"#d51b23"})}}),w="","monitor_ps"==namerol?e="monitor":"practicante_ps"==namerol?e="practicante":"profesional_ps"==namerol?e="profesional":"sistemas"==namerol&&(e="sistemas");var e=[];e.id=v,e.name=w,e.namerol=namerol,d(e),"practicante_ps"==namerol?(a("input[name=profesional]").prop("disabled",!0),a("input[name=practicante]").prop("disabled",!0),k(),h(namerol),j(namerol),i(namerol),g(v),p(),f(o),b(o,e)):"profesional_ps"==namerol?(a("input[name=practicante]").prop("disabled",!0),a("input[name=profesional]").prop("disabled",!0),k(),j(namerol),h(namerol),g(v),i(namerol),p(),f(o),b(o,e)):"monitor_ps"==namerol?(k(),h(namerol),j(namerol),i(namerol),g(v),p(),b(o,e)):"sistemas"==namerol&&(k(),h(namerol),j(namerol),i(namerol),g(v),p(),f(o),c(o))})}}});
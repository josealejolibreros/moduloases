define(["jquery","block_ases/sweetalert","block_ases/datatables"],function(a,b,c){return{init:function(){function b(){var b=a("#username_input").val(),c=new Array;c.push({name:"function",value:"search"}),c.push({name:"username",value:b}),a.ajax({type:"POST",data:c,url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(b){var c=b.error;c?swal({title:"Error",html:!0,type:"error",text:b.error,confirmButtonColor:"#D3D3D3"}):(a("#username_input").prop("disabled",!0),a("#lista_programas").prop("disabled",!1),a("#name_lastname").val(b.firstname+" "+b.lastname),a("#lista_programas").append('<option value="'+b.cod_programa+'" selected> '+b.cod_programa+" - "+b.nombre_programa+"</option>"),1==b.seg_academico?a('label input[name="segAca"][ value="1"]').prop("checked",!0):a('label input[name="segAca" ][ value="0"]').prop("checked",!0),1==b.seg_asistencias?a('label input[name="segAsis" ][ value="1"]').prop("checked",!0):a('label input[name="segAsis"][ value="0"]').prop("checked",!0),1==b.seg_socioeducativo?a('label input[name="segSoc" ][ value="1"]').prop("checked",!0):a('label input[name="segSoc"][ value="0"]').prop("checked",!0))},dataType:"json",cache:"false",error:function(a){console.log(a)}})}function c(){a("#lista_programas").html(""),a.ajax({type:"POST",data:[{name:"function",value:"load_programs"}],url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(b){if(a("#lista_programas").append('<option value="0" selected> 0000 - Ninguno</option>'),b)for(x in b)a("#lista_programas").append('<option value="'+b[x].cod_univalle+'">'+b[x].cod_univalle+" - "+b[x].nombre+"</option>")},dataType:"json",cache:"false",error:function(a){console.log(a)}})}function d(){a("#username_input").prop("disabled",!1),a("#name_lastname").prop("disabled",!1);var b=a("#username_input").val(),d=a("#lista_programas option[value='"+a("#lista_programas").val()+"']").text(),f=(a("#lista_programas").val(),a("input, select").serializeArray());a("#username_input").prop("disabled",!0),a("#name_lastname").prop("disabled",!0);var g=0,h=location.search.split("&");for(x in h)if(h[x].indexOf("instanceid")>=0){var i=h[x].split("=");g=i[1]}f.push({name:"idinstancia",value:g}),f.push({name:"function",value:"updateUser"}),a.ajax({type:"POST",data:f,url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(f){f===!0?(swal({title:"Actualizado con exito!!",html:!0,type:"success",text:"El usuario con código "+b+" es ahora administrador del sistema de "+d,confirmButtonColor:"#d51b23"},function(a){}),a("#next_div").fadeIn(),e(),c()):swal({title:"Error :(",html:!0,type:"error",text:f,confirmButtonColor:"#d51b23"},function(a){})},dataType:"json",cache:"false",error:function(a){console.log(a)}})}function e(){var b=new Array;b.push({name:"function",value:"loadSystemAdministrators"}),a.ajax({type:"POST",data:b,url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(b){a("#div_users").empty(),a("#div_users").append('<table id="tableUsers" class="display" cellspacing="0" width="100%"><thead><thead></table>');a("#tableUsers").DataTable(b);a("#div_users #delete_user").css("cursor","pointer")},dataType:"json",cache:"false",error:function(a){console.log(a)}})}function f(b){var d=new Array;d.push({name:"function",value:"deleteUser"}),d.push({name:"username",value:b}),a.ajax({type:"POST",data:d,url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(a){a===!0?(swal({title:"Actualizado con exito!!",html:!0,type:"success",text:"El usuario con código "+b+" se ha eliminado satisfactoriamente",confirmButtonColor:"#d51b23"},function(a){}),e(),c()):swal({title:"Error :(",html:!0,type:"error",text:a,confirmButtonColor:"#d51b23"},function(a){})},dataType:"json",cache:"false",error:function(a){console.log(a)}})}a(document).ready(function(){a("#search_button").on("click",function(){a(".assignment_li").removeClass("hidden");var c=a("#username_input").val();return null===c||""==c?0:void b()}),a("#ok_button").on("click",function(){d()}),a("#cancel_button").on("click",function(){a(".assignment_li").addClass("hidden"),a("#form_mon_student").fadeOut(),a("#username_input").val(""),a("#username_input").prop("disabled",!1),a("#name_lastname").val(" "),a("#form_prof_type").fadeOut()}),a("#next").on("click",function(){var a="upload_files_form.php";location.href=a+location.search}),a("#listadministradores").on("click",function(){e()}),e(),a("#div_users").on("click","#delete_user",function(){var b=a("#div_users #tableUsers").DataTable(),c=a(this).parent(),d=(a(this).children("span").attr("id"),b.cell(c).index().column,b.cell(b.row(c).index(),0).data()),e=b.cell(b.row(c).index(),1).data(),g=b.cell(b.row(c).index(),2).data();swal({title:"¿Estas seguro/a?",text:"Al usuario <strong>"+e+" "+g+"</strong> con código <strong>"+d+"</strong> se le inhabilitará los permisos de administrador del sistema</strong>.<br><strong>¿Estás de acuerdo con los cambios que se efectuarán?</strong>",type:"warning",html:!0,showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si!",cancelButtonText:"No",closeOnConfirm:!0},function(a){a&&f(d)})})})}}});
define(["jquery","block_ases/bootstrap","block_ases/validator","block_ases/sweetalert"],function(a,b,c,d){return{init:function(){function b(){var b=[];return a("#mytable_consult > tbody  > tr > td").each(function(){"talentos"==a(this).attr("id")&&b.push(a(this).html())}),b}function c(a){for(var b=[],c=document.location.search.substring(1),d=c.split("&"),e=0;e<d.length;e++){var f=d[e].split("=");b[f[0]]=f[1]}return b}function d(){var b=new Array,d=c(document.location.search);b.push({name:"function",value:"load_grupal"}),b.push({name:"idinstancia",value:d.instanceid}),a.ajax({type:"POST",data:b,url:"../managers/user_management/seguimiento.php",success:function(b){if(a("#mytable tbody").html(""),0!=b.rows){var c=b.content;for(x in c)a("#mytable tbody").append("<tr> <td>"+c[x].username+"</td> <td>"+c[x].firstname+"</td> <td>"+c[x].lastname+'</td>  <td class="hide">'+c[x].idtalentos+"</td> </tr>")}else a("#list_grupal_seg").append("<a>No registra ningun estudiante a su cargo.Por favor dirigete a la oficina de Sistemas de talentos pilos para gestionar tu situación</a>")},dataType:"json",cache:"false",error:function(a){alert("error al cargar estudiantes")}})}function e(b,d){void 0===b&&(b=null),void 0===d&&(d=null);var e=new Array,f=c(document.location.search);e.push({name:"function",value:"load_grupal"}),e.push({name:"idinstancia",value:f.instanceid}),a.ajax({type:"POST",data:e,url:"../managers/user_management/seguimiento.php",success:function(c){if(a("#seguimiento #mytable_consult tbody").html(""),0!=c.rows){var d=c.content;if(b)for(x in d)b.indexOf(x)!=-1?a("#seguimiento #mytable_consult tbody").append(" <tr> <td>"+d[x].username+"</td> <td>"+d[x].firstname+"</td> <td>"+d[x].lastname+'</td>  <td><input type="checkbox" checked="checked" id="asistencia" name="asistencia"  value="'+d[x].idtalentos+'"/></td>  </tr>'):a("#seguimiento #mytable_consult tbody").append("<tr> <td>"+d[x].username+"</td> <td>"+d[x].firstname+"</td> <td>"+d[x].lastname+'</td>  <td><input type="checkbox" id="asistencia" name="asistencia" value="'+d[x].idtalentos+'"/></td>  </tr>');else for(x in d)a("#seguimiento #mytable_consult tbody").append("<tr> <td>"+d[x].username+"</td> <td>"+d[x].firstname+"</td> <td>"+d[x].lastname+'</td>  <td><input type="checkbox" id="asistencia" name="asistencia" value="'+d[x].idtalentos+'"/></td>  </tr>')}else a("#seguimiento #list_grupal_seg").append("<a>No registra ningun estudiante a su cargo.Por favor dirigete a la oficina de Sistemas de talentos pilos para gestionar tu situación</a>");var e=a("#upd_seg").prop("name");a("#edit_seg").prop("name",e)},dataType:"json",cache:"false",error:function(a){alert("error al cargar listado de asistencia")}})}function f(){for(var b=new Date,c=(b.getDate(),b.getMonth()+1,b.getFullYear(),b.getMinutes()),d=b.getHours(),e="",f=0;f<24;f++)f==d?(d<10&&(d="0"+d),e+='<option value="'+d+'" selected>'+d+"</option>"):e+=f<10?'<option value="0'+f+'">0'+f+"</option>":'<option value="'+f+'">'+f+"</option>";for(var g="",f=0;f<60;f++)f==c?(c<10&&(c="0"+c),g+='<option value="'+c+'" selected>'+c+"</option>"):g+=f<10?'<option value="0'+f+'">0'+f+"</option>":'<option value="'+f+'">'+f+"</option>";a("#seguimiento #h_ini").append(e),a("#seguimiento #m_ini").append(g),a("#seguimiento #h_fin").append(e),a("#seguimiento #m_fin").append(g),a("#seguimiento").find("input:text, textarea").val(""),a("#seguimiento #infomonitor").addClass("hide"),a("#upd_seg").attr("disabled",!1),a("#upd_seg").attr("title",""),a("#seguimiento").find("select, textarea, input").attr("disabled",!1)}function g(){a("#list_grupal").html("");var b=new Array,d=c(document.location.search);b.push({name:"function",value:"loadSegMonitor"}),b.push({name:"tipo",value:"GRUPAL"}),b.push({name:"idinstancia",value:d.instanceid}),a.ajax({type:"POST",data:b,url:"../managers/user_management/seguimiento.php",success:function(b){var c=b.error;if(c)swal({title:c,html:!0,type:"error",text:b.msg,confirmButtonColor:"#D3D3D3"});else{var d=b.result,e=b.rows;if(e>0){for(x in d)a("#list_grupal").append('<div class="container well col-md-12"> <div class="container-fluid col-md-10" name="info"><div class="row"><label class="col-md-3" for="fecha_des">Fecha</label><label class="col-md-9" for="tema_des">Tema</label> </div> <div class="row"> <input type="text" class="col-md-3" value='+d[x].fecha+' id="fecha_seg" name="fecha_seg" disabled> <input type="text" class="col-md-9" value='+d[x].tema+' id="tema_seg" name="tema_seg" disabled> </div></div> <div id='+d[x].id+' class="col-md-2" name="div_button_seg"> <span class="btn btn-danger" id="consult_grupal" name="consult_grupal" data-toggle="modal" data-target="#myModal">Detalle</span><span class="btn btn-warning" id="delete_grupal" name="delete_grupal">Borrar</span> </div></div>');a("#list_grupal").on("click","#consult_grupal",function(){var b=a(this).parent().attr("id");a("#upd_seg").removeClass("hide"),a("#upd_seg").prop("name",b),i(b,"GRUPAL")}),a("#list_grupal").on("click","#delete_grupal",function(){var b=a(this).parent().attr("id");h(b)})}else a("#list_grupal").append("<label>No registra</label><br>")}},dataType:"json",cache:"false",error:function(a){alert("error al cargar seguimiento monitor")}})}function h(b){swal({title:"¿Seguro que desea eliminar el registro?",text:"No podrás deshacer este paso",type:"warning",showCancelButton:!0,cancelButtonText:"No",confirmButtonColor:"#d51b23",confirmButtonText:"Si",closeOnConfirm:!1},function(){a.ajax({type:"POST",data:{id:b,"function":"delete"},url:"../../../blocks/ases/managers/user_management/seguimiento.php",async:!1,success:function(a){0==a?swal({title:"error al borrar registro",html:!0,type:"error",confirmButtonColor:"#d51b23"}):(setTimeout("document.location.reload()",500),swal("¡Hecho!","El registro ha sido eliminado","success"))},dataType:"text",cache:"false",error:function(a){alert("error al eliminar seguimiento")}})})}function i(b,d,e){var g=new Array,h=c(document.location.search);a("#save_seg").addClass("hide"),f(),g.push({name:"function",value:"getSeguimiento"}),g.push({name:"id",value:b}),g.push({name:"idinstancia",value:h.instanceid}),g.push({name:"tipo",value:d}),a.ajax({type:"POST",data:g,url:"../managers/user_management/seguimiento.php",success:function(b){var c=b.error;if(c)swal({title:c,html:!0,type:"error",text:b.msg,confirmButtonColor:"#D3D3D3"});else if(a("#place").val(b.seguimiento.lugar),a("#tema").val(b.seguimiento.tema),a("#objetivos").val(b.seguimiento.objetivos),a("#actividades").val(b.seguimiento.actividades),a("#observaciones").val(b.seguimiento.observaciones),a("#h_ini option[value="+b.hour.h_ini+"]").attr("selected",!0),a("#m_ini option[value="+b.hour.m_ini+"]").attr("selected",!0),a("#h_fin option[value="+b.hour.h_fin+"]").attr("selected",!0),a("#m_fin option[value="+b.hour.m_fin+"]").attr("selected",!0),a("#date").val(b.hour.seguimiento.fecha),a("#seguimiento :input").prop("disabled",!0),a("#mytable_consult tbody").html(""),0!=b.rows){var d=b.content;for(x in d)a("#mytable_consult tbody").append("<tr> <td>"+d[x].username+"</td> <td>"+d[x].firstname+"</td> <td>"+d[x].lastname+'</td>  <td id="talentos"  class = "hide">'+d[x].idtalentos+"</td> </tr>")}else a("#list_grupal_seg_consult").append("<a>No registra ningun estudiante a su cargo.Por favor dirigete a la oficina de Sistemas de talentos pilos para gestionar tu situación</a>")},dataType:"json",cache:"false",error:function(a){alert("error al ver detalles de seguimientos")}})}function j(b){var c,d,e,f,g,h,i,j,k,l=!0,m="";a.each(b,function(a,b){switch(b.name){case"date":c=b.value;break;case"place":k=b.value;break;case"h_ini":d=b.value;break;case"m_ini":e=b.value;break;case"h_fin":f=b.value;break;case"m_fin":g=b.value;break;case"tema":h=b.value;break;case"objetivos":i=b.value;break;case"actividades":actividades=b.value;break;case"observaciones":observaciones=b.value;break;case"idtalentos":j=b.value}}),c||(l=!1,m+="* Selecciona una Fecha de seguimiento valida: date<br>"),void 0!=k&&""!=k||(m+="* Seleccione el lugar : lugar<br>",l=!1),void 0!=actividades&&""!=actividades||(m+="* Seleccione las actividades que se realizaron : actividades<br>",l=!1),void 0!=observaciones&&""!=observaciones||(m+="* Seleccione las observaciones : observaciones<br>",l=!1),d>f?(l=!1,m+="* La hora final debe ser mayor a la inicial<br>"):d==f&&e>g&&(l=!1,m+="* La hora final debe ser mayor a la inicial<br>"),0===j.length&&(l=!1,m+="* Selecciona los estudiantes que asistieron al seguimiento: "+j.length+"<br>"),""==h&&(l=!1,m+='* La informacion de "observaciones" es obligatoria :'+h+"<br>"),""==i&&(l=!1,m+='* La informacion de "Objetivos" es obligatoria:'+i+"<br>");var n={isvalid:l,detalle:m};return n}function k(){var b=a("#ficha_estudiante #codigo").serializeArray();a.ajax({type:"POST",data:b,url:"../managers/search_profile.php",success:function(b){var d=b.error;if(a("#ficha_estudiante input,textarea").val(""),a("#ficha_estudiante #nombreficha").text(""),a("#ficha_estudiante #email").text(""),a("#ficha_estudiante #cohorte").text(""),d)swal({title:"No encotrado",html:!0,type:"error",text:d,confirmButtonColor:"#d51b23"},function(a){if(a){var b=location.search.split("&");window.history.pushState(null,null,"talentos_profile.php"+b[0]+"&"+b[1])}});else{var e=c(document.location.search);canSeeStudent(b.idtalentos,e,function(a){if(a.result){var c=location.search.split("&"),d=location.href.split("?")[0]+c[0]+"&"+c[1]+"&talento_id="+b.username;location.href=d}else swal({title:"ÁREA RESTRINGIDA",html:!0,type:"warning",text:"No tienes permisos para ver la información de este estudiante.<br> Dirigete a la oficina de Sistemas del plan talentos pilos para gestionar tu situación",confirmButtonColor:"#d51b23"},function(b){b&&(location.href=a.pagina)})})}},dataType:"json",cache:"false",error:function(a){alert("Error "+a)}})}a(document).ready(function(){d(),g(),a("#socioedu_add_grupal").click(function(){a("#save_seg").removeClass("hide"),a("#div_created").addClass("hide"),a("#upd_seg").addClass("hide"),a("#myModalLabel").attr("name","GRUPAL"),f(),e()}),a("#close_seg").on("click",function(){a("#edit_seg").addClass("hide")}),a("#go_back").on("click",function(){window.history.back()}),a("#edit_seg").click(function(){var b=new Array,d=c(document.location.search),e=a(this).prop("name");a("#seguimiento input[id=asistencia]:checked").each(function(){var c=a(this).val();b.push(c)}),a("#myModalLabel").attr("name","GRUPAL");var f=a("#myModalLabel").attr("name"),h=a("#seguimiento").serializeArray();h.push({name:"function",value:"update"}),h.push({name:"tipo",value:f}),h.push({name:"id_seg",value:e}),h.push({name:"idtalentos",value:b}),h.push({name:"idinstancia",value:d.instanceid}),h.push({name:"idmonitor",value:120});var i=j(h);i.isvalid?a.ajax({type:"POST",data:h,url:"../managers/user_management/seguimiento.php",success:function(b){var c=b.error;c?swal({title:c,html:!0,type:"error",text:b.msg,confirmButtonColor:"#D3D3D3"}):(swal({title:"Actualizado con exito!!!",html:!0,type:"success",text:b.msg,confirmButtonColor:"#d51b23"}),a("#myModal").modal("toggle"),a("#myModal").modal("toggle"),a("#save_seg").addClass("hide"),a(".modal-backdrop").remove(),g())},dataType:"json",cache:"false",error:function(a){alert("error al actualizar seguimiento")}}):swal({title:"Error",html:!0,type:"warning",text:"Detalles del error:<br>"+i.detalle,confirmButtonColor:"#D3D3D3"})}),a("#save_seg").click(function(){var b=new Array,d=c(document.location.search);a("#seguimiento input[id=asistencia]:checked").each(function(){var c=a(this).val();b.push(c)});var e=a("#myModalLabel").attr("name"),f=a("#seguimiento").serializeArray();f.push({name:"function",value:"new"}),f.push({name:"tipo",value:e}),f.push({name:"idtalentos",value:b}),f.push({name:"idinstancia",value:d.instanceid}),f.push({name:"idmonitor",value:120});var h=j(f);h.isvalid?a.ajax({type:"POST",data:f,url:"../managers/user_management/seguimiento.php",success:function(b){var c=b.error;c?swal({title:c,html:!0,type:"error",text:b.msg,confirmButtonColor:"#D3D3D3"}):(swal({title:"Actualizado con exito!!",html:!0,type:"success",text:b.msg,confirmButtonColor:"#d51b23"}),a("#myModal").modal("toggle"),a("#myModal").modal("toggle"),a("#save_seg").addClass("hide"),a(".modal-backdrop").remove(),g())},dataType:"json",cache:"false",error:function(a){alert("error al guardar seguimiento")}}):swal({title:"Error",html:!0,type:"warning",text:"Detalles del error:<br>"+h.detalle,confirmButtonColor:"#D3D3D3"})}),a("#upd_seg").click(function(){a(this).attr("name");a("#seguimiento :input").prop("disabled",!1);var c=b();e(c,!0),a("#edit_seg").removeClass("hide"),a("#upd_seg").addClass("hide")})}),a("#ficha_estudiante #editar_ficha").click(function(){a("#ficha_estudiante").find("input, textarea").prop("readonly",!1),a("#profesional_ps").prop("readonly",!0),a("#practicante_ps").prop("readonly",!0),a("#monitor_ps").prop("readonly",!0),a("#ficha_estudiante").find("select").prop("disabled",!1),a(this).hide(),a("#ficha_estudiante #cancel").fadeIn(),a("#ficha_estudiante #save").fadeIn(),a("#ficha_estudiante #codigo").attr("readonly",!0),a("#ficha_estudiante #search").fadeOut()}),a("#ficha_estudiante #cancel").click(function(){swal({title:"Estas seguro/a de cancelar?",text:"Los cambios realizados no serán tomados en cuenta y se perderán",type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si!",cancelButtonText:"No",closeOnConfirm:!0},function(b){b&&(a("#ficha_estudiante").find("input, textarea").prop("readonly",!0),a("#ficha_estudiante").find("select").prop("disabled",!0),a(this).hide(),a("#ficha_estudiante #save").fadeOut(),a("#ficha_estudiante #cancel").fadeOut(),a("#ficha_estudiante #editar_ficha").fadeIn(),a("#ficha_estudiante #codigo").attr("readonly",!1),a("#ficha_estudiante #search").fadeIn(),k())})}),a("#ficha_estudiante #go_back").on("click",function(){var a="index.php",b=location.search.split("&");location.href=a+b[0]+"&"+b[1]}),a("#ficha_estudiante").on("click",".accordion-toggle",function(b){b.preventDefault();var c=a(this),d=c.next(".accordion-content"),e=a(this).children(".toggle-icon");c.toggleClass("open"),c.hasClass("open")?e.html("<i class='glyphicon glyphicon-chevron-down whitesmoke'></i>"):e.html("<i class='glyphicon glyphicon-chevron-left'></i>"),d.slideToggle(250)}),a(document).on("click","panel-heading",function(b){a(".panel-collapse.in").removeClass("in").addClass("collapse")})}}});
define(["jquery","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui"],function(a,b,c,d){return{init:function(){function b(b,c,d){a.ajax({type:"POST",data:{course:b,element:c,type_e:d,type:"loadParentCat"},url:"../managers/grade_categories/grader_processing.php",success:function(b){a("#padre").html(b.html)},dataType:"json",cache:"false",error:function(a){console.log(a)}})}function c(b,c,d){a.ajax({type:"POST",data:{type_ajax:"deleteElement",id:b,courseid:c,type:d},url:"../managers/grade_categories/grader_processing.php",success:function(a){swal({title:"Listo",text:a.msg,type:"success",showCancelButton:!1,showConfirmButton:!1,timer:1200}),e(c)},dataType:"json",cache:"false",error:function(a){console.log(a)}})}function d(){for(var a=window.location.search.split("&"),b=0;b<a.length;b++){var c=a[b].split("=");if("?id_course"==c[0]||"id_course"==c[0])var d=c[1]}return d}function e(b){a.ajax({type:"POST",data:{course:b,type:"loadCat"},url:"../managers/grade_categories/grader_processing.php",success:function(b){a("#mymodalbody").html(b)},dataType:"text",cache:"false",error:function(a){console.log(a)}})}function f(b,c){var f=a("#tipoItem").val(),k=d();if("CATEGORÍA"==f){if(j(b)){var l=a.trim(a("#inputNombre").val()),m=a("#inputValor").val(),n=g(a("#tipoCalificacion").prop("selectedIndex"));a.ajax({type:"POST",data:{course:k,parent:c,fullname:l,agregation:n,tipo:f,peso:m},url:"../managers/grade_categories/grader_processing.php",success:function(a){1==a?(swal({title:"Categoria añadida con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),e(k)):0==a&&swal({title:"Error al añadir la categoria (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(a){swal({title:"Error al intentar añadir la categoria",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else if("ÍTEM"==f){if(h(b)){var l=a.trim(a("#inputNombre").val()),m=a("#inputValor").val();a.ajax({type:"POST",data:{course:k,parent:c,fullname:l,tipo:f,peso:m},url:"../managers/grade_categories/grader_processing.php",success:function(a){1==a?(swal({title:"item añadido con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),e(k)):0==a&&swal({title:"Error al añadir el item (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(a){swal({title:"Error al intentar añadir el item",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else if("PARCIAL"==f){if(i(b)){var l=a.trim(a("#inputNombre").val()),m=a("#inputValor").val();a.ajax({type:"POST",data:{course:k,parent:c,fullname:l,agregation:6,tipo:f,peso:m},url:"../managers/grade_categories/grader_processing.php",success:function(a){1==a?(swal({title:"Categoria añadida con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),e(k)):0==a&&swal({title:"Error al añadir la categoria (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(a){swal({title:"Error al intentar añadir la categoria",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else swal({title:"Seleccione el tipo de elemento que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}function g(a){switch(a){case 1:return 0;case 2:return 10}}function h(b){var c=a.trim(a("#inputNombre").val());if(""==c)return swal({title:"Ingrese el nombre del ítem que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;if(10==b){var d=a("#inputValor").val();if(""==d)return swal({title:"Ingrese un peso válido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1}return!0}function i(b){var c=a.trim(a("#inputNombre").val());if(""==c)return swal({title:"Ingrese el nombre del parcial que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;if(10==b){var d=a("#inputValor").val();if(""==d)return swal({title:"Ingrese un peso válido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1}return!0}function j(b){if(0==a("#tipoCalificacion").prop("selectedIndex"))return swal({title:"Seleccione el tipo de calificación de la categoría que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;var c=a.trim(a("#inputNombre").val());if(""==c)return swal({title:"Ingrese el nombre de la categoría que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;if(10==b){var d=a("#inputValor").val();if(""==d)return swal({title:"Ingrese un peso válido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1}return!0}var k;a(document).on("click","#wizard_button",function(){a("#modalCategories").modal({backdrop:!1}),a(".fondo").show(),id=d(),e(id)}),a(document).on("click",".mymodal-close",function(){location.reload(),a(".fondo").hide()}),a(document).on("click",".edit",function(){var c=a(this).attr("title");a("#titulo").text(c),a("#nombre_editar").show(),a("#label_nombre").show();var e=d(),f=a(this).attr("id");if(a("#save_edit").attr("name",f),"Editar Categoría"===c){a("#type_cal").show();var g=a(this).parent().parent().attr("id");a("#otro").hide(),10!=g&&0!=g&&6!=g&&(g=99,a("#otro").show()),a("#calific").prop("value",g);var h="cat",i=a(this).parent().parent().text();if(i.search("-")==-1){nom_text=i.split("("),i=nom_text[0],l=nom_text[1],a("#peso").show(),l=l.replace("(",""),l=l.replace(")",""),l=l.replace(" ",""),l=l.replace("%",""),k=l,a("#peso_editar").val(l);var j=a(this).attr("data-maxweight");a(".maxweight-edit").attr("id",j)}else i=i.split("-")[0],a("#peso").hide()}else{a("#type_cal").hide();var l=a(this).parent().parent().prev().text();if("-"==l)a("#peso").hide(),a("#peso_editar").val(l);else{a("#peso").show(),l=l.replace("(",""),l=l.replace(")",""),l=l.replace(" ",""),l=l.replace("%",""),k=l,a("#peso_editar").val(l);var j=a(this).parent().attr("id");a(".maxweight-edit").attr("id",j)}var h="it",i=a(this).parent().parent().prev().prev().attr("title");"Enlazar a la actividad Tarea"==i&&(a("#nombre_editar").hide(),a("#label_nombre").hide())}a("#nombre_editar").val(i),b(e,f,h),a("#edit").modal({backdrop:!1})}),a(document).on("click","#save_edit",function(){var b=a(this).attr("name"),c=a("#nombre_editar").val(),f=a("#peso_editar").val(),g=parseFloat(a(".maxweight-edit").attr("id"))+parseFloat(k),h=a("#calific").val(),i=a("#padre").val();if("-"==f&&(f=0),"99"==h)return void swal({title:"Tipo de Calificacion no valida.",text:"No es posible editar una categoria con un tipo de calificacion diferente a Promedio Simple, Promedio Ponderado, o Calificacion mas alta.\n Por favor seleccione uno de estos tipos de calificacion",html:!0,type:"warning",confirmButtonColor:"#d51b23"});if(f>g)return void swal({title:"Peso no valido.",text:"El peso ingresado supera el peso máximo posible de la categoria padre que es: "+g+"% \n Para crear un nuevo elemento primero configure los pesos de los demas.",html:!0,type:"warning",confirmButtonColor:"#d51b23"});if(""==c)return void swal({title:"Ingrese el nuevo nombre del elemento",html:!0,type:"warning",confirmButtonColor:"#d51b23"});var j=a("#titulo").text();"Ítem"==j.split(" ")[1]?(type_e="it",h=!1):type_e="cat";var l=d();a.ajax({type:"POST",data:{course:l,element:b,type_e:type_e,newNombre:c,newPeso:f,newCalific:h,type:"editElement",parent:i},url:"../managers/grade_categories/grader_processing.php",success:function(b){b.error?swal("Error",b.error,"error"):(swal({title:"Listo",text:b.msg,type:"success",showCancelButton:!1,showConfirmButton:!1,timer:1300}),a("#edit").modal("hide"),e(l),console.log(b))},dataType:"json",cache:"false",error:function(a){console.log("AJAXerror"),console.log(a)}})}),a(document).on("click",".delete",function(){var b=a(this).parent().parent().parent().attr("id").split("_"),e=d(),f=b[1],g=b[0];if("cat"===g)var h="esta categoría";else var h="este item";var i="Esta seguro que desea eliminar "+h+"?";swal({title:i,text:"Tenga en cuenta que NO SE PODRAN RECUPERAR ninguna de la notas que haya registrado en este elemento una vez borrado!",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Aceptar, Borrar "+h,cancelButtonText:"Cancelar",closeOnConfirm:!1,closeOnCancel:!1},function(a){a?c(f,e,g):swal({title:"Cancelado",type:"error",showCancelButton:!1,showConfirmButton:!1,timer:1200})})}),a(document).on("click",".new",function(){var b=a(this).parent().parent().children().next(".maxweight").attr("id");if(b<=0)return void swal({title:"No se pueden crear mas categorías o ítems en la categoria seleccionada.",text:"\n\r El peso de los elementos dentro de ésta suma 100%.\n\r Para crear un nuevo elemento primero configure los pesos de los demas.",html:!0,type:"warning",confirmButtonColor:"#d51b23"});a(".new").prop("disabled",!0),a(".delete").prop("disabled",!0),a(".edit").prop("disabled",!0);var c=a("<div class = 'divForm'>");c.load("../templates/categories_form.html");var g=a(this).parent().parent();g.append('<hr style = "border-top: 1px solid #ddd">'),g.append(c),window.setTimeout(function(){var b=g.attr("id");10==b&&(a("#divPeso").show(),a("#inputValor").on("blur",function(){var b=a(this).val(),c=parseInt(a(this).parent().parent().parent().parent().children().next(".maxweight").attr("id"));(b<0||b>c)&&(swal({title:"El valor debe estar entre 0 y el peso máximo: "+c,text:"\n\rUsted ingresó: "+b,html:!0,type:"warning",confirmButtonColor:"#d51b23"}),a(this).val(""))}),a("#inputValor").on("keypress",function(a){return tecla=document.all?a.keyCode:a.which,8==tecla||46==tecla||(patron=/[0-9]/,tecla_final=String.fromCharCode(tecla),patron.test(tecla_final))})),a("#tipoItem").on("change",function(){var b=a(this).prop("selectedIndex");1==b?a("#divTipeC").show():a("#divTipeC").hide()}),a("#save").on("click",function(){var b=a(this).parent().parent().parent().parent().attr("id"),c=a(this).parent().parent().parent().parent().parent().attr("id");c=c.split("_")[1],f(b,c)}),a("#cancel").on("click",function(){var a=d();e(a)})},400)})}}});